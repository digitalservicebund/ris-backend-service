{
  "$defs": {
    "ExtractionConfig": {
      "properties": {
        "label": {
          "description": "Label for extracted entities (e.g., 'date', 'court')",
          "title": "Label",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional fixed value",
          "title": "Value"
        },
        "priority": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Priority for this extraction (higher = more important)",
          "title": "Priority"
        },
        "mark_tag": {
          "default": false,
          "description": "Mark the entire tag as extracted when this rule matches",
          "title": "Mark Tag",
          "type": "boolean"
        }
      },
      "required": ["label"],
      "title": "ExtractionConfig",
      "type": "object"
    },
    "ExtractionRule": {
      "description": "A rule for extracting information with a label and one or more patterns.",
      "properties": {
        "name": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Name of the rule (for logging and debugging purposes)",
          "title": "Name"
        },
        "extractions": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/ExtractionConfig"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Extractions to create when this rule matches",
          "title": "Extractions"
        },
        "section_markers": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/$defs/SectionMarkerConfig"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Section markers to add when this rule matches",
          "title": "Section Markers"
        },
        "patterns": {
          "description": "List of alternative patterns, each is a sequence of token constraints",
          "items": {
            "anyOf": [
              {
                "items": {
                  "$ref": "#/$defs/TokenConstraint"
                },
                "type": "array"
              },
              {
                "type": "string"
              }
            ]
          },
          "title": "Patterns",
          "type": "array"
        },
        "greedy": {
          "anyOf": [
            {
              "enum": ["FIRST", "LONGEST"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Matching strategy for overlapping matches",
          "title": "Greedy"
        },
        "conditions": {
          "anyOf": [
            {
              "items": {
                "enum": [
                  "is_short_line",
                  "is_not_short_line",
                  "is_table",
                  "is_first_line",
                  "is_centered"
                ],
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of condition validator names to apply (e.g., ['is_short_line'])",
          "title": "Conditions"
        },
        "skip_sections": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Disable rule in these sections",
          "title": "Skip Sections"
        },
        "normalizers": {
          "anyOf": [
            {
              "items": {
                "const": "date_to_iso",
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "List of normalizers to apply to matched text (e.g., ['date_to_iso'])",
          "title": "Normalizers"
        }
      },
      "required": ["patterns"],
      "title": "ExtractionRule",
      "type": "object"
    },
    "SectionMarkerConfig": {
      "properties": {
        "label": {
          "description": "Label for section marker (e.g., 'tenor')",
          "title": "Label",
          "type": "string"
        },
        "line_offset": {
          "default": 0,
          "description": "Where to start the section (0 = current line, 1 = next line, etc.)",
          "title": "Line Offset",
          "type": "integer"
        },
        "max_lines": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Maximum number of lines",
          "title": "Max Lines"
        }
      },
      "required": ["label"],
      "title": "SectionMarkerConfig",
      "type": "object"
    },
    "TokenConstraint": {
      "additionalProperties": true,
      "description": "A single token constraint in a pattern, similar to spaCy's token patterns",
      "properties": {
        "TEXT": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Text"
        },
        "LOWER": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Lower"
        },
        "REGEX": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Regex"
        },
        "IN": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "In"
        },
        "NOT_IN": {
          "anyOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Not In"
        },
        "IS_DIGIT": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Is Digit"
        },
        "IS_ALPHA": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Is Alpha"
        },
        "IS_TITLE": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Is Title"
        },
        "IS_UPPER": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Is Upper"
        },
        "IS_SENT_START": {
          "anyOf": [
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Is Sent Start"
        },
        "SHAPE": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Shape"
        },
        "OP": {
          "anyOf": [
            {
              "enum": ["?", "*", "+", "!"],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Op"
        }
      },
      "title": "TokenConstraint",
      "type": "object"
    }
  },
  "description": "Configuration for a single extraction ruleset.",
  "properties": {
    "name": {
      "description": "Unique module name (e.g., 'ner', 'sections')",
      "title": "Name",
      "type": "string"
    },
    "skip_sections": {
      "anyOf": [
        {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "List of section labels to skip during extraction",
      "title": "Skip Sections"
    },
    "rules": {
      "description": "List of extraction rules for this module",
      "items": {
        "$ref": "#/$defs/ExtractionRule"
      },
      "title": "Rules",
      "type": "array"
    }
  },
  "required": ["name", "rules"],
  "title": "RulesetDef",
  "type": "object"
}
